<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,minimum-scale=1.0,user-scalable=no">
	<title>JC_demo</title>
	<style type="text/css">
    * {padding:0;margin:0;}
    body {overflow: hidden;}
    </style>
</head>
<body>
<canvas id="demo_canvas" width="320" height="410"></canvas>

<script type="text/javascript" src="./js/jc.js"></script>
<script type="text/javascript">
window.onerror = function(msg,url,line){
	alert('line::::'+line+'url::::'+url+'msg::::'+msg);
}

	window.onresize = function(){
		resize();
	}
	var Images = new JC.ImagesLoad({
                            'bg': './images/background.jpg',
                            'bgad': './images/background_abd.jpg',
                            'card1': './images/card01.png',
                            'card2': './images/card02.png',
                            'card3': './images/card03.png',
                            'card4': './images/card04.png',
                            'card5': './images/card05.png',
                            'effects': './images/effects.png',
                            'list': './images/list_assets.png'
                        });


    var w = window.innerWidth,
        h = Math.max(window.innerHeight,460),
        bgDOC,
        sea,
        shipDOC,
        screenDOC,
        cardL=[],
        cardR=[],
        cardLDOC,
        cardRDOC,
        ship,
        vs,
        effect,
        shipgun=[],
        shipgunPos = [{x: 244,y: 282,scale: 0.6},{x: 222,y: 282,scale: 0.7},{x: 190,y: 280,scale: 0.8},{x: 150,y: 274,scale: 0.9},{x: 112,y: 266,scale: 1}],
        cardl = ['card1','card2','card3','card4','card5'],
        cardr = ['card5','card4','card1','card3','card2'],
        battle,
        bottom,
        knifeL,
        knifeR,
        stage,
        rotate,
        isOK = false,
        screenFree = false;

        stage = new JC.Stage('demo_canvas');
        stage.resize(w,h);

        bgDOC = new JC.Container();
        shipDOC = new JC.Container();
        screenDOC = new JC.Container();
        cardLDOC = new JC.Container();
        cardRDOC = new JC.Container();

        knifeDOC = new JC.Container();

        cardLDOC.x = 70;
        cardRDOC.x = 250;
        cardLDOC.y = 230;
        cardRDOC.y = 230;
        cardLDOC.scaleX = cardLDOC.scaleY = .7;
        cardRDOC.scaleX = cardRDOC.scaleY = .7;
    
        screenDOC.addChild(bgDOC,shipDOC);
    Images.imagesLoaded = function (){
        sea = new JC.Sprite({
                            image: Images.getResult('bg'),
                            width: 428,
                            height: 508
                        });
        sea.x = w/2;
        sea.y = -70;
        sea.regY = 0;
        
        bgDOC.addChild(sea);

        ship = new JC.Sprite({
                            image: Images.getResult('list'),
                            width: 400,
                            height: 480,
                            sH: 2,
                            sW: 2
                        });
        ship.regX = 0;
        ship.regY = 0;
        shipDOC.y = -5;
        shipDOC.scaleX = shipDOC.scaleY = .8;
        shipDOC.addChild(ship);
        for(var i=0;i<5;i++){
        	shipgun[i] = new JC.Sprite({
                            image: Images.getResult('list'),
                            width: 216,
                            height: 241,
                            sH: 2,
                            sW: 760
                        });
        	shipgun[i].x = shipgunPos[i].x;
        	shipgun[i].y = shipgunPos[i].y;
        	shipgun[i].rotation = -76;
        	shipgun[i].alpha = 0;
        	shipgun[i].scaleX = shipgun[i].scaleY = shipgunPos[i].scale;
        	shipDOC.addChild(shipgun[i]);

        	cardL[i] = new JC.Sprite({
                            image: Images.getResult(cardl[i]),
                            width: 220,
                            height: 220
                        });
        	cardL[i].alpha = 0;
        	cardL[i].scaleX = cardL[i].scaleY = 3;

        	cardR[i] = new JC.Sprite({
                            image: Images.getResult(cardr[i]),
                            width: 220,
                            height: 220
                        });
        	cardR[i].alpha = 0;
        	cardR[i].scaleX = cardR[i].scaleY = 3;

        	cardLDOC.addChild(cardL[i]);
        	cardRDOC.addChild(cardR[i]);
        }

        battle = new JC.Sprite({
                            image: Images.getResult('list'),
                            width: 98,
                            height: 653,
                            sH: 260,
                            sW: 851
                        });
        battle.x = 160;
        battle.y = -24;
        battle.rotation = -90;
        battle.scaleX = battle.scaleY = .5;

        bottom = new JC.Sprite({
                            image: Images.getResult('list'),
                            width: 720,
                            height: 314,
                            sH: 500,
                            sW: 2
                        });
        bottom.x = 160;
        bottom.y = 520;
        bottom.regY = 200;
        bottom.scaleX = bottom.scaleY = .5;

        vs = new JC.Sprite({
                            image: Images.getResult('list'),
                            width: 329,
                            height: 339,
                            sH: 4,
                            sW: 430
                        });
        vs.x = 160;
        vs.y = 180;
        vs.rotation = -90;
        vs.alpha = 0;
        effect = new JC.Sprite({
                            image: Images.getResult('effects'),
                            width: 190,
                            height: 242,
                            sH: 18,
                            sW: 312
                        });
        effect.x = 160;
        effect.y = 180;
        effect.regY = 122;
        effect.regX = 110;
        effect.alpha = 0;
        knifeL = new JC.Sprite({
                            image: Images.getResult('list'),
                            width: 433,
                            height: 67,
                            sH: 350,
                            sW: 412
                        });
        knifeL.scaleY = -.8;
        knifeL.scaleX = .8;
        knifeL.rotation = -45;
        knifeL.x = -300;
        knifeL.y = 166;

        knifeR = new JC.Sprite({
                            image: Images.getResult('list'),
                            width: 433,
                            height: 67,
                            sH: 350,
                            sW: 412
                        });
        knifeR.scaleY = knifeR.scaleX = .8;
        knifeR.rotation = -135;
        knifeR.x = 620;
        knifeR.y = 166;

        rotate = new JC.Sprite({
                            image: Images.getResult('list'),
                            width: 118,
                            height: 118,
                            sH: 502,
                            sW: 728
                        });
        rotate.x = 160;
        rotate.y = 178;
        rotate.alpha = 0;
        rotate.scaleX = rotate.scaleY = 3;


        stage.addChild(screenDOC,cardLDOC,cardRDOC,vs,knifeR,knifeL,rotate,effect,battle,bottom);

        // screenDOC.x = 80;
        // screenDOC.y = 20;
        screenDOC.scaleX = screenDOC.scaleY = 1.6;



		render();

		setTimeout(function(){
			screenIn();
			cardIn();
		},800)
        
    }

    document.addEventListener('touchstart',function(){
        if(isOK){
            isOK = false;
            vsOut();
            battleOut();
            bottomOut();
            cardHide();
        }
        
    },false)


    function knifeIn(){
        knifeL.moveTween({
                    attr: {
                        x: 160
                    },
                    time: 600,
                    fx: 'bounceOut'
                })
        knifeR.moveTween({
                    attr: {
                        x: 160
                    },
                    time: 600,
                    fx: 'bounceOut',
                    complete: function(){
                        rotate.moveTween({
                            attr: {
                                scaleX: .8,
                                scaleY: .8,
                                alpha: 1
                            },
                            time: 400,
                            fx: 'easeInStrong',
                            complete: function(){
                                effect.alpha = 1;
                                effect.scaleX = effect.scaleY = 0;
                                effect.moveTween({
                                    attr: {
                                        scaleX: 3,
                                        scaleY: 3,
                                        alpha: 0
                                    },
                                    time: 300,
                                    fx: 'easeOut',
                                    complete: function(){
                                    }
                                })
                            }
                        })
                    }
                })
    }
    function cardIn(){
    	var i = 0;
    	var timer = setInterval(function(){
			cardL[i].moveTween({
					attr: {
						scaleX: 1,
						scaleY: 1,
						alpha: 1
					},
					time: 400,
					fx: 'easeOut'
				})
			cardR[i].moveTween({
					attr: {
						scaleX: 1,
						scaleY: 1,
						alpha: 1
					},
					time: 400,
					fx: 'easeOut'
				})
			i++;
			if(i>=5){
				clearInterval(timer);
				setTimeout(function(){
					cardOut()
				},500)
			}
    	},100)
    }
    function cardHide(){
        var i = 4;
        var timer = setInterval(function(){
            cardL[i].moveTween({
                    attr: {
                        x: -260
                    },
                    time: 600,
                    fx: 'backIn',
                    complete: function(){
                        console.log(this.x);
                    }
                })
            cardR[i].moveTween({
                    attr: {
                        x: 260
                    },
                    time: 600,
                    fx: 'backIn',
                    complete: function(){
                        console.log(this.x);
                    }
                })
            i--;
            if(i<0){
                clearInterval(timer);
            }
        },100)
    }
    function cardOut(){
		var xl= [60,20,5,0,0];// -Math.abs(i-3)*20;
		var xr= [-60,-15,-2,14,-5];// -Math.abs(i-3)*20;

    	for(var i=0;i<5;i++){
    		var y=(i-3)*84;
    		var s=1+(i-4)/10;

			cardL[i].moveTween({
					attr: {
						scaleX: s,
						scaleY: s,
						y: y,
						x: xl[i]
					},
					time: 300,
					fx: 'easeOut'
				})
			cardR[i].moveTween({
					attr: {
						scaleX: s,
						scaleY: s,
						y: y,
						x: xr[i]
					},
					time: 300,
					fx: 'easeOut'
				})
    	}
    	setTimeout(function(){
    		vs.moveTween({
					attr: {
						scaleX: .5,
						scaleY: .5,
						alpha: 1
					},
					time: 1000,
					fx: 'elasticOut',
					complete: function(){
						effect.alpha = 1;
						effect.moveTween({
							attr: {
								scaleX: 3,
								scaleY: 3,
								alpha: 0
							},
							time: 300,
							fx: 'easeOut',
                            complete: function(){
                                isOK = true;
                            }
						})
					}
				})
    	},400)
    }

    function vsOut(){
        vs.moveTween({
                attr: {
                    scaleX: 2,
                    scaleY: 2,
                    alpha: 0
                },
                time: 800,
                fx: 'elasticIn',
                complete: function(){
                    console.log(this.alpha);
                }
            })
    }

    function screenIn(){
        screenDOC.moveTween({
				attr: {
					scaleX: 1.2,
					scaleY: 1.2,
					x: -80,
                    y: -30
				},
				time: 800,
				fx: 'easeOut',
				complete: function(){
					screenDOC.moveTween({
						attr: {
							scaleX: 1,
							scaleY: 1,
							x: 0,
                            y: 0
						},
						time: 500,
						fx: 'easeOut',
						complete: function(){
					        
					        setTimeout(function(){
                                screenFree = true;
						        bottomIn();
						        battleIn();
					        },100)
						}
					});
				}
			});
    }
    function battleIn(){
        battle.moveTween({
				attr: {
					y: 24
				},
				time: 800,
				fx: 'elasticOut',
				complete: function(){
					shipGun();
			        shipDOC.lll = 0;
			        shipD();
			        sea.lll = 0;
			        seaD();
				}
			});
    }
    function bottomIn(){
        bottom.moveTween({
				attr: {
					y: 410
				},
				time: 800,
				fx: 'elasticOut'
			});
    }
    function battleOut(){
        battle.moveTween({
                attr: {
                    y: -24
                },
                time: 800,
                fx: 'elasticIn'
            });
    }
    function bottomOut(){
        bottom.moveTween({
                attr: {
                    y: 520
                },
                time: 800,
                fx: 'elasticIn',
                complete: function(){
                    setTimeout(function(){
                        bottomIn();
                        knifeIn();
                        battle.moveTween({
                                    attr: {
                                        y: 24
                                    },
                                    time: 800,
                                    fx: 'elasticOut'
                                })
                    },1000)
                }
            });
    }
    function seaD(){
    	sea.lll = (++sea.lll)%2;
    	
    	sea.moveTween({
				attr: {
					y: -70+sea.lll*2
				},
				time: 1200,
				fx: 'easeBoth',
				complete: function(){
					seaD();
				}
			});
    }

    function shipD(){
    	shipDOC.lll = (++shipDOC.lll)%2;
    	
    	shipDOC.moveTween({
				attr: {
					y: -5+shipDOC.lll*5
				},
				time: 1500,
				fx: 'easeBoth',
				complete: function(){
					shipD();
				}
			});
    }

    function shipGun(){
    	var l = shipgun.length;
    	var ran = Math.floor(Math.random()*l);
    	shipgun[ran].moveTween({
				attr: {
					alpha: 1
				},
				time: 100,
				fx: 'easeOut',
				complete: function(){
					this.alpha = 0;
					setTimeout(function(){
						shipGun();
					},1e3+Math.random()*1e3)
				}
			});
    }
    function render(){
        RAF(render);
        rotate.rotation = (2+rotate.rotation)%360;
        if(screenFree){
            screenDOC.scaleX = 1+Math.sin(Math.PI*rotate.rotation/180)*.01;
            screenDOC.scaleY = 1+Math.cos(Math.PI*rotate.rotation/180)*.015;
        }

        stage.render();
    }
    function resize(){
    	w = window.innerWidth;
		h = window.innerHeight;
		//stage.resize(w,h);
    }
</script>
</body>
</html>